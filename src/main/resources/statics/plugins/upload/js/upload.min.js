(function(h){h.fn.extend({upload:function(l,k){if(typeof l!="object"){alert("参数错误!");return}var j=h(this);var p=j.attr("id");if(l.url){l.server=l.url;delete l.url}if(l.success){var n=l.success;delete l.success}if(l.error){var o=l.error;delete l.error}h.each(e("#"+p),function(q,r){l[q]=l[q]||r});if(l.buttonText){l.pick["label"]=l.buttonText;delete l.buttonText}if(typeof(l.multi)!="undefined"){l.pick["multiple"]=l.multi;delete l.multi}var i=d(l);i.deletefuc=l.ondelete;if(!WebUploader.Uploader.support()){alert(" 上传组件不支持您的浏览器！");return false}i.showlist=l.showlist;if(l.initFiles){f(j,l.initFiles,i)}var m=true;i.on("fileQueued",function(r){c(j,r,i);var q=j.parents(".parentFileBox:first").find("li").length;if((parseInt(q))==this.options.fileNumLimit){j.find("label").css("cursor","not-allowed");j.find("input").attr("disabled","true")}if(this.options.fileNumLimit==1){h("#"+p).hide()}});i.on("uploadProgress",function(s,r){var q=h("#"+p).parent().find("#fileBox_"+s.id);var t=q.find(".diyBar");t.show();r=r*100;g(r.toFixed(2),t)});i.on("uploadFinished",function(){});i.on("uploadAccept",function(q,r){if(k){k(r)}});i.on("uploadSuccess",function(u,s){var q=h("#"+p).parent().find("#fileBox_"+u.id);var v=q.find(".diyBar");var t=q.find(".diyCancel");var r=q.find("#fileid");q.find(".viewThumb").find("img").remove();q.find(".viewThumb").append('<a href="'+s.realpath+'" class="swipebox" title=""><img src="'+s.realpath+'" ></a>');r.val(s.fileid);t.attr("attachment-path",s.path);v.fadeOut(1000,function(){});if(n){n(s,i,u)}});i.on("uploadError",function(r,t){var q=h("#"+p).parent().find("#fileBox_"+r.id);var u=q.find(".diyBar");g(0,u,"上传失败!");var s="上传失败! 文件:"+r.name+" 错误码:"+t;if(o){o(s)}});i.on("beforeFileQueued",function(r,s){var q=j.parents(".parentFileBox:first").find("li").length;if(parseInt(q)>=this.options.fileNumLimit){if(m==true){alert("上传文件数量最大为 "+this.options.fileNumLimit);m=false;if((parseInt(q))==this.options.fileNumLimit){j.find("label").css("cursor","not-allowed");j.find("input").attr("disabled","true")}}return false}});i.on("fileDequeued",function(q,r){});
i.on("error",function(q){var r="";switch(q){case"F_DUPLICATE":r="该文件已经被选择了!";break;case"Q_EXCEED_NUM_LIMIT":r="上传文件数量超过限制!";break;case"F_EXCEED_SIZE":r="文件大小超过限制!";break;case"Q_EXCEED_SIZE_LIMIT":r="所有文件总大小超过限制!";break;case"Q_TYPE_DENIED":r="文件类型不正确或者是空文件!";break;default:r="未知错误!";break}alert(r)})}});function e(i){return{swf:ctxStatic+"/upload/js/Uploader.swf",pick:{id:i,label:"上传"},accept:{title:"Images",extensions:"gif,jpg,jpeg,bmp,png",mimeTypes:"image/*"},duplicate:true,auto:true,thumb:{width:100,height:100,quality:100,allowMagnify:false,crop:false,type:"image/jpeg"},method:"POST",server:"",sendAsBinary:false,chunked:false,chunkSize:512*1024,fileNumLimit:1,fileSizeLimit:5000*1024,fileSingleSizeLimit:5000*1024}}function d(i){return new WebUploader.Uploader(i)}function g(j,m,l){if(j>=100){j=j+"%";l=l||"上传完成"}else{j=j+"%";l=l||j}var k=m.find(".diyProgress");var i=m.find(".diyProgressText");k.width(j);i.text(l)}function b(n,l,j,k){var p=n.find(".diyCancel").attr("attachment-path");var q={status:true};if(q.status==true){try{j.removeFile(l)}catch(m){}var o=k.parents(".parentFileBox:first").find("li").length;o=o-1;if(o<j.options.fileNumLimit){isalert=true;k.find("label").css("cursor","pointer");k.find("input").removeAttr("disabled")}h("#"+k.attr("id")).show();n.remove();var i=n.find("#fileid").val();if(j.deletefuc){j.deletefuc(i,p)}}else{}}function c(k,j,i){var l=j.id;var o=k.parents(".parentFileBox:first");var q='<li id="fileBox_'+l+'" class="diyUploadHover"> 					<div class="viewThumb"><span style="height:100%;display:inline-block;vertical-align:middle"></span></div> 					<input id="fileid" name="fileid" type="hidden"> 					<div class="diyCancel"></div> 					<div class="diySuccess"></div> 					<div class="diyFileName">点击查看大图</div>					<div class="diyBar"> 							<div class="diyProgress"></div> 							<div class="diyProgressText">0%</div> 					</div> 				</li>';o.children(".fileBoxUl").children("#"+k.attr("id")).before(q);var n=o.find("#fileBox_"+l);if(typeof(i.showlist)!="undefined"&&i.showlist==false){n.hide()}else{n.show()
}var p=n.children(".diyCancel").one("click",function(){b(h(this).parent("li"),l,i,k)});if(j.type.split("/")[0]!="image"){var m=a(j.name.split(".").pop());n.addClass(m);return}i.makeThumb(j,function(s,r){if(!s){n.find(".viewThumb").append('<img src="'+r+'" >')}})}function f(n,v,l){var j="/data/upload/";var k=v.split(",");var p=0;for(var o in k){p--;if(k[o]==""){continue}var s=n.parents(".parentFileBox:first");var u='<li id="fileBox_'+p+'" class="diyUploadHover"> 						<div class="viewThumb"><span style="height:100%;display:inline-block;vertical-align:middle"></span></div> 						<div class="diyCancel" attachment-path="'+k[o].replace(j,"")+'"></div> 						<div class="diySuccess"></div> 						<div class="diyFileName"></div>						<div class="diyBar"> 								<div class="diyProgress"></div> 								<div class="diyProgressText">0%</div> 						</div> 					</li>';s.children(".fileBoxUl").children("#"+n.attr("id")).before(u);var r=s.find("#fileBox_"+p);if(typeof(l.showlist)!="undefined"&&l.showlist==false){r.hide()}else{r.show()}var t=r.children(".diyCancel").one("click",function(){b(h(this).parent("li"),p,l,n)});setTimeout(function(){if(l.options.fileNumLimit==1){n.find("label").css("cursor","pointer");n.find("input").removeAttr("disabled");h("#"+n.attr("id")).hide()}var i=n.parents(".parentFileBox:first").find("li").length;if((parseInt(i))==l.options.fileNumLimit){n.find("label").css("cursor","not-allowed");n.find("input").attr("disabled","true")}},100);if(typeof(l.showlist)!="undefined"&&l.showlist==false){continue}var m=k[o].split(".").pop();if("gif,jpg,jpeg,bmp,png".indexOf(m)==-1){var q=a(k[o].split(".").pop());r.addClass(q);continue}r.find(".viewThumb").append('<a href="'+k[o]+'" class="swipebox" title=""><img src="'+k[o]+'" ></a>')}}function a(j){var i={};var k="_diy_bg";i.pdf="pdf";i.zip="zip";i.rar="rar";i.csv="csv";i.doc="doc";i.xls="xls";i.xlsx="xls";i.txt="txt";i=i[j]||"txt";return i+k}})(jQuery);$(function(){$(".swipebox").swipebox()});